define(["require","application"],function(n,e,t){"use strict";var a=e.uefi,r=e.$$cacheUrl,i=(angular.bootstrap,angular.forEach),o=angular.merge,u=Array.prototype.slice,c=angular.isFunction,s=angular.isArray,l=angular.isDefined,p=angular.isString,f=function(n){if(!n)return n;for(var t=/\$\{([a-zA-Z\.\-0-9/]+)\}/g,a=0;a<100;a++){var r=t.exec(n);if(!r)return n;var i=e[r[1]];if(!i||!p(i))throw new Error("CANNT RESOLVE VAR `"+r+"`");n=n.replace(t,i)}throw new Error("TO MANY LEVELS IN VAR RESOLVE.")};setTimeout(function(){a.progress("Application","loading"),n([r("json!lib/system/modules/configuration.json")],function(p){function m(n,e){return l(n)?n:e}var d={includes:[],dynamic:!1,safe:!1};t=p,function l(p,g){p.length&&(l.$remaining=0|l.$remaining,l.$remaining+=p.length,n(p.map(function(n){return r(f(0===n.indexOf("json!")?n:"json!"+n))}),function(){var y=u.apply(arguments);i(y,function(n,e){g.includes.push(n),n.dynamic=m(n.dynamic,m(g.dynamic,!0)),n.safe=m(n.safe,m(g.safe,!1)),i(n.modules,function(e){e.dynamic=m(e.dynamic,m(n.dynamic,!0)),e.safe=m(e.safe,m(n.safe,!1))});var t=p[e].split("/");if(t.pop(),n.dir=t.length?t.join("/"):"",n.includes&&s(n.includes)){var a=n.includes.map(function(n){return t.length?t.concat(n).join("/"):n});n.includes=[],l(a,n)}});(l.$remaining-=y.length)||(d=d.includes[0],o(e,{name:"APPLICATION"},d.environment),function(o){function s(e,t){n(e,function(){function n(e){n.times=0|n.times,n.times++>10||(r=setTimeout(function(){n(e);var t=[];throw e.forEach(function(n){n.resolved||t.push(n.name)}),new Error("DETECTED INIT HUNG UP WITHIN 30 SECONDS.\nPlease check out following modules:\n\t"+t.join("\n\t"))},3e4))}var e=[],a=arguments.length,r=null;if(0==a)return t(e);u.apply(arguments).map(function(i,o,s){function l(){u.apply(arguments).forEach(function(n){n&&(e.push(n),s.forEach(function(e){n.name==e.name&&(e.resolved=!0)}))}),--a<1&&(r&&clearTimeout(r),t(e))}c(i.module)?(i.module(l),r||n(s)):(i.name=i.module.name,l(i.module))})})}function l(n,e){return i(e.modules||{},function(t,a){var o={language:t.language||{},script:f(t.script),templateUrl:f(t.template),extras:{dynamic:t.dynamic,safe:t.safe,path:a}};e.dir&&(o.script=p(e,o.script),o.templateUrl=p(e,o.templateUrl),i(o.language,function(n,t){o.language[t]=p(e,n)}),o.extras.path="/"+p(e,a)),o.script=r(o.script),i(o.language,function(n,e){o.language[e]=r("json!"+n)}),n.push(o)}),e.includes&&i(e.includes||[],function(e){n=n.concat(l([],e))}),n}function p(n,e){return e&&"/"!=e[0]?[n.dir,e].join("/"):e}var m=l([],o),d=[function(n){a.progress("Application","prepare system modules"),e.$$config(t.depends||{});var r=t.includes||[];i(r,function(n){a.progress("Application","prepare system module > "+n)}),s(r,n)},function(n){a.progress("Application","prepare user modules"),s(m.filter(function(n){return n.ready=!n.extras.dynamic}).map(function(n){return a.progress("Application","prepare user module > "+n.extras.path),n.script}),n)}];i(m,function(n){n.extras.path===e.layout&&(e.layout=n,n.extras.layout=!0,n.extras.safe=!0,n.extras.dynamic=!1)}),e.routes=m.filter(function(n){return!n.extras.layout&&n.templateUrl}),function n(e){d.length?d.shift()(function(t){n(e.concat(t))}):(e=e.map(function(n){return a.progress("Application","bootstrap module > "+n.name),n.name}),angular.bootstrap(document,e,{strictDi:!0}),a.progress("Application","ready",!0))}([])}(d))}))}(["application.json"],d)})})});