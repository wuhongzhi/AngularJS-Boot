define(["require","application"],function(n,e,r){"use strict";var t=e.uefi,a=e.$$cacheUrl,i=(angular.bootstrap,angular.forEach),o=angular.merge,u=Array.prototype.slice,s=angular.isFunction,c=angular.isArray,l=angular.isDefined,p=angular.isString,f=function(n){if(!n)return n;for(var r=/\$\{([a-zA-Z\.\-0-9/]+)\}/g,t=0;t<100;t++){var a=r.exec(n);if(!a)return n;var i=e[a[1]];if(!i||!p(i))throw new Error("CANNT RESOLVE VAR `"+a+"`");n=n.replace(r,i)}throw new Error("TO MANY LEVELS IN VAR RESOLVE.")};setTimeout(function(){t.progress("Application","loading"),n([a("json!lib/system/modules/configuration.json")],function(p){function d(n,e){return l(n)?n:e}var m,g={includes:[],dynamic:!1,safe:!1};r=p,function l(p,h){p.length&&(l.$remaining=0|l.$remaining,l.$remaining+=p.length,n(p.map(function(n){return a(f(0===n.indexOf("json!")?n:"json!"+n))}),function(){var y=u.apply(arguments);i(y,function(n,e){h.includes.push(n),n.dynamic=d(n.dynamic,d(h.dynamic,!0)),n.safe=d(n.safe,d(h.safe,!1)),i(n.modules,function(e){e.dynamic=d(e.dynamic,d(n.dynamic,!0)),e.safe=d(e.safe,d(n.safe,!1)),e.depends=e.depends||[]});var r=function(n){var e=[];return n.split("/").forEach(function(n){".."===n?e.pop():"."!==n&&e.push(n)}),e.join("/")}(p[e]).split("/");if(r.pop(),n.dir=r.length?r.join("/"):"",n.includes&&c(n.includes)){var t=n.includes.map(function(n){return r.length?r.concat(n).join("/"):n});n.includes=[],l(t,n)}h===g?m=g.includes[0].environment||{}:o(m,n.environment||{})});(l.$remaining-=y.length)||(g=g.includes[0],o(e,{name:"APPLICATION"},m),function(o){function c(e,r){n(e,function(){function n(e){n.times=0|n.times,n.times++>10||(a=setTimeout(function(){n(e);var r=[];throw e.forEach(function(n){n.resolved||r.push(n.name)}),new Error("DETECTED INIT HUNG UP WITHIN 30 SECONDS.\nPlease check out following modules:\n\t"+r.join("\n\t"))},3e4))}var e=[],t=arguments.length,a=null;if(0==t)return r(e);u.apply(arguments).map(function(i,o,c){function l(){u.apply(arguments).forEach(function(n){n&&(e.push(n),c.forEach(function(e){n.name==e.name&&(e.resolved=!0)}))}),--t<1&&(a&&clearTimeout(a),r(e))}s(i.module)?(i.module(l),a||n(c)):(i.name=i.module.name,l(i.module))})})}function l(n,e){return i(e.modules||{},function(r,t){var o={language:r.language||{},script:f(r.script),templateUrl:f(r.template),extras:{dynamic:r.dynamic,safe:r.safe,deps:r.depends,path:t}};e.dir&&(o.script=d(e,o.script),o.templateUrl=d(e,o.templateUrl),i(o.language,function(n,r){o.language[r]=d(e,n)}),o.extras.path="/"+d(e,t)),o.script=a(o.script),i(o.language,function(n,e){o.language[e]=a("json!"+n)}),n.push(o)}),e.includes&&i(e.includes||[],function(e){n=n.concat(l([],e))}),n}function p(n,e){return n.extras.deps.forEach(function(n){var r=h.find(function(e){return e.extras.path===n&&e.extras.dynamic});r&&(t.progress("Application","prepare dependency module > "+n),e.push(r),p(r,e))}),e}function d(n,e){return e&&"/"!=e[0]?[n.dir,e].join("/"):e}var m=l([],o),g=[function(n){t.progress("Application","prepare system modules"),e.$$config(r.depends||{});var a=r.includes||[];i(a,function(n){t.progress("Application","prepare system module > "+n)}),c(a,n)},function(n){t.progress("Application","prepare user modules");var e=[];m.filter(function(n){return n.ready=!n.extras.dynamic}).forEach(function(n){t.progress("Application","prepare user module > "+n.extras.path),p(n,e).push(n)}),c(e=e.map(function(n){return n.extras.dynamic=!1,n.script}),n)}];i(m,function(n){n.extras.path===e.layout&&(e.layout=n,n.extras.layout=!0,n.extras.safe=!0,n.extras.dynamic=!1)});var h=m.filter(function(n){return!n.extras.layout&&!n.templateUrl});e.routes=m.filter(function(n){return!n.extras.layout&&n.templateUrl}),e.dependModules=p,function n(e){g.length?g.shift()(function(r){n(e.concat(r))}):(e=e.map(function(n){return t.progress("Application","bootstrap module > "+n.name),n.name}),angular.bootstrap(document,e,{strictDi:!0}),t.progress("Application","ready",!0))}([])}(g))}))}(["application.json"],g)})})});