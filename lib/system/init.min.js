define(["require","application"],function(n,e,t){"use strict";function r(n){var e=[];return n.split("/").forEach(function(n){".."===n?e.pop():"."!==n&&e.push(n)}),e.join("/")}var a=e.uefi,i=e.$$cacheUrl,o=(angular.bootstrap,angular.forEach),u=angular.merge,s=Array.prototype.slice,c=angular.isFunction,l=angular.isArray,p=angular.isDefined,f=angular.isString,m=function(n){if(!n)return n;for(var t=/\$\{([a-zA-Z\.\-0-9/]+)\}/g,r=0;r<100;r++){var a=t.exec(n);if(!a)return n;var i=e[a[1]];if(!i||!f(i))throw new Error("CANNT RESOLVE VAR `"+a+"`");n=n.replace(t,i)}throw new Error("TO MANY LEVELS IN VAR RESOLVE.")};setTimeout(function(){a.progress("Application","loading"),n([i("json!lib/system/modules/configuration.json")],function(f){function d(n,e){return p(n)?n:e}var g,h={includes:[],dynamic:!1,safe:!1};t=f,function p(f,y){f.length&&(p.$remaining=0|p.$remaining,p.$remaining+=f.length,n(f.map(function(n){return i(m(0===n.indexOf("json!")?n:"json!"+n))}),function(){var v=s.apply(arguments);o(v,function(n,e){y.includes.push(n),n.dynamic=d(n.dynamic,d(y.dynamic,!0)),n.safe=d(n.safe,d(y.safe,!1)),o(n.modules,function(e){e.dynamic=d(e.dynamic,d(n.dynamic,!0)),e.safe=d(e.safe,d(n.safe,!1)),e.depends=e.depends||[]});var t=r(f[e]).split("/");if(t.pop(),n.dir=t.length?t.join("/"):"",n.includes&&l(n.includes)){var a=n.includes.map(function(n){return t.length?t.concat(n).join("/"):n});n.includes=[],p(a,n)}y===h?g=h.includes[0].environment||{}:u(g,n.environment||{})});(p.$remaining-=v.length)||(h=h.includes[0],u(e,{name:"APPLICATION"},g),function(u){function l(e,t){n(e,function(){function n(e){n.times=0|n.times,n.times++>10||(a=setTimeout(function(){n(e);var t=[];throw e.forEach(function(n){n.resolved||t.push(n.name)}),new Error("DETECTED INIT HUNG UP WITHIN 30 SECONDS.\nPlease check out following modules:\n\t"+t.join("\n\t"))},3e4))}var e=[],r=arguments.length,a=null;if(0==r)return t(e);s.apply(arguments).map(function(i,o,u){function l(){s.apply(arguments).forEach(function(n){n&&(e.push(n),u.forEach(function(e){n.name==e.name&&(e.resolved=!0)}))}),--r<1&&(a&&clearTimeout(a),t(e))}c(i.module)?(i.module(l),a||n(u)):(i.name=i.module.name,l(i.module))})})}function p(n,e){return o(e.modules||{},function(t,a){var u={language:t.language||{},script:m(t.script),templateUrl:m(t.template),extras:{dynamic:t.dynamic,safe:t.safe,deps:t.depends,path:a}};e.dir&&(u.script=f(e,u.script),u.templateUrl=f(e,u.templateUrl),o(u.language,function(n,t){u.language[t]=f(e,n)}),u.extras.path="/"+f(e,a)),u.script=i(u.script),o(u.language,function(n,e){u.language[e]=i("json!"+n)}),o(u.extras.deps,function(n,e){u.extras.deps[e]=r(u.extras.path+"/"+n)}),n.push(u)}),e.includes&&o(e.includes||[],function(e){n=n.concat(p([],e))}),n}function f(n,e){return e&&"/"!=e[0]?[n.dir,e].join("/"):e}var d=p([],u),g=[function(n){a.progress("Application","prepare system modules"),e.$$config(t.depends||{});var r=t.includes||[];o(r,function(n){a.progress("Application","prepare system module > "+n)}),l(r,n)},function(n){a.progress("Application","prepare user modules"),l(d.filter(function(n){return n.ready=!n.extras.dynamic}).map(function(n){return a.progress("Application","prepare user module > "+n.extras.path),n.script}),n)}];o(d,function(n){n.extras.path===e.layout&&(e.layout=n,n.extras.layout=!0,n.extras.safe=!0,n.extras.dynamic=!1)}),e.routes=d.filter(function(n){return!n.extras.layout&&n.templateUrl}),e.components=d.filter(function(n){return!n.extras.layout&&!n.templateUrl}),function n(e){g.length?g.shift()(function(t){n(e.concat(t))}):(e=e.map(function(n){return a.progress("Application","bootstrap module > "+n.name),n.name}),angular.bootstrap(document,e,{strictDi:!0}),a.progress("Application","ready",!0))}([])}(h))}))}(["application.json"],h)})})});