define(["require","application"],function(n,e,r){"use strict";var t=e.uefi,a=t.prodMode,i=e.$$cacheUrl,o=(angular.bootstrap,angular.forEach),u=angular.merge,c=Array.prototype.slice,s=angular.isFunction,l=angular.isArray,f=angular.isDefined,p=angular.isString,d={};t.progress("Application","loading"),n([i("json!lib/system/etc/module.json")],function(m){function g(n,e){if(!e)return e;for(var r=/\$\{([a-zA-Z\.\-0-9/]+)\}/g,t=0;t<100;t++){var a=r.exec(e);if(!a)return e;var i=n[a[1]];if(!i||!p(i))throw new Error("CANNT RESOLVE VAR `"+a+"`");e=e.replace(r,i)}throw new Error("TO MANY LEVELS IN VAR RESOLVE.")}function y(n,e){return f(n)?n:e}function h(n,e){return e&&"/"!==e[0]?v([n.dir||"",e].join("/")):e}function v(n){var e=[];return n.split("/").forEach(function(n){".."===n?e.pop():"."!==n&&e.push(n)}),e.join("/")}var E,A={includes:[]},x={};r=m,function f(p,m,$){p.length&&(f.$remaining=0|f.$remaining,f.$remaining+=p.length,n(p.map(function(n){return i(g(e,0===n.indexOf("json!")?n:"json!"+n))}),function(){var j=c.apply(arguments);o(j,function(n,e){m.includes.push(n),m===A?(E=A.includes[0].environment||{},$.safe=!!E.safe,$.dynamic=!!E.dynamic):(u(E,n.environment||{}),delete n.environment);var r=y(n.safe,y($.safe,!1)),t=y(n.dynamic,y($.dynamic,!0));o(n.modules,function(n){n.safe=y(n.safe,y(r,!1)),n.dynamic=y(n.dynamic,y(t,!0))}),delete n.safe,delete n.dynamic;var a=v(p[e]).split("/");if(a.pop(),n.dir=a.length?a.join("/"):"",n.includes&&l(n.includes)){var i=n.includes.filter(function(n){return"string"==typeof n}).map(function(n){return a.length?a.concat(n).join("/"):n});n.includes=n.includes.filter(function(n){return"string"!=typeof n}),f(i,n,{dynamic:t,safe:r})}o(n.modules||{},function(e,r){function t(n,e){return n?e?"/"!==n[0]?"/"+n:n:"/"===n[0]?n.substr(1):n:n}e.script=t(h(n,g(E,e.script))),e.template=t(h(n,g(E,e.template))),o(e.language||{},function(r,a){e.language[a]=t(h(n,r))}),x[t(h(n,r),!0)]=e}),delete n.dir});(f.$remaining-=j.length)||(a||function(){var n=angular.module;angular.module=function(){var e=arguments[0],r=n.apply(angular,arguments);return angular.forEach(r,function(n,t){if("function"==typeof n&&"info"!==t&&"config"!==t&&"run"!==t){if(n.$$hook)return;var a=r[t]=function(){var a=arguments[0],i=d[a]=d[a]||{};return i[a]?console.warn(t+"::"+a+" in module "+e+" was already defined in "+i[a]):(i[a]=e,console.debug("define "+t+"::"+a+" in module "+e)),n.apply(r,arguments),r}.bind(r);a.$$hook=!0,angular.forEach(a,function(n,e){"function"==typeof n&&(a[e]=n)})}}),r}.bind(angular)}(),u(e,{name:"APPLICATION"},E),A={environment:E,modules:x},a||console.debug("application.json:\n"+JSON.stringify(A,null,4)),function(u){function l(e,r){n(e,function(){function n(e){n.times=0|n.times,n.times++>10||(a=setTimeout(function(){n(e);var r=[];throw e.forEach(function(n){n.resolved||r.push(n.name)}),new Error("DETECTED INIT HUNG UP WITHIN 30 SECONDS.\nPlease check out following modules:\n\t"+r.join("\n\t"))},3e4))}var e=[],t=arguments.length,a=null;if(0==t)return r(e);c.apply(arguments).map(function(i,o,u){function l(){c.apply(arguments).forEach(function(n){n&&(e.push(n),u.forEach(function(e){n.name==e.name&&(e.resolved=!0)}))}),--t<1&&(a&&clearTimeout(a),r(e))}s(i.module)?(i.module(l),a||n(u)):(i.name=i.module.name,l(i.module))})})}function f(n,e){return n.extras.deps.forEach(function(n){var r=m.find(function(e){return e.extras.path===n&&e.extras.dynamic});r&&(t.progress("Application","prepare dependency module > "+n),e.push(r),f(r,e))}),e}var p=function(n,e){return o(u.modules||{},function(e,r){var t={language:e.language||{},script:i(e.script),templateUrl:e.template,extras:{path:r,deps:e.depends||[],safe:e.safe,dynamic:e.dynamic}};o(t.language,function(n,e){t.language[e]=i("json!"+n)}),n.push(t)}),n}([]),d=[function(n){t.progress("Application","prepare system modules"),e.$$config(r.depends||{});var a=r.includes||[];o(a,function(n){t.progress("Application","prepare system module > "+n)}),l(a,n)},function(n){t.progress("Application","prepare user modules");var e=[];p.filter(function(n){return n.ready=!n.extras.dynamic}).forEach(function(n){t.progress("Application","prepare user module > "+n.extras.path),f(n,e).push(n)}),l(e=e.map(function(n){return n.extras.dynamic=!1,n.script}),n)}];o(p,function(n){n.extras.path===e.layout&&(e.layout=n,n.extras.layout=!0,n.extras.safe=!0,n.extras.dynamic=!1)});var m=p.filter(function(n){return!n.extras.layout&&!n.templateUrl});e.routes=p.filter(function(n){return!n.extras.layout&&n.templateUrl}),e.dependModules=f,function n(e){if(d.length)d.shift()(function(r){n(e.concat(r))});else{e=e.map(function(n){return t.progress("Application","bootstrap module > "+n.name),n.name}),a||t.progress("Application","verify done");var r=document.body||document.querySelector&&document.querySelector("body");angular.bootstrap(r,e,{strictDi:!0}),t.progress("Application","ready",!0)}}([])}(A))}))}(["application.json"],A,{dynamic:!1,safe:!1})})});