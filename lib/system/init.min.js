define(["require","application"],function(d,m,g){"use strict";var y=m.uefi,h=y.prodMode,v=m.$$cacheUrl,E=(angular.bootstrap,angular.forEach),A=angular.merge,x=Array.prototype.slice,$=angular.isFunction,j=angular.isArray,r=angular.isDefined,i=angular.isString,b=function(n){if(!n)return n;for(var e=/\$\{([a-zA-Z\.\-0-9/]+)\}/g,r=0;r<100;r++){var t=e.exec(n);if(!t)return n;var a=m[t[1]];if(!a||!i(a))throw new Error("CANNT RESOLVE VAR `"+t+"`");n=n.replace(e,a)}throw new Error("TO MANY LEVELS IN VAR RESOLVE.")},N={};function w(n,e){return e&&"/"!=e[0]?S([n.dir,e].join("/")):e}function S(n){var e=[];return n.split("/").forEach(function(n){".."===n?e.pop():"."!==n&&e.push(n)}),e.join("/")}y.progress("Application","loading"),d([v("json!lib/system/etc/module.json")],function(n){var l,p={includes:[]};function f(n,e){return r(n)?n:e}g=n,function o(u,c,s){u.length&&(o.$remaining=0|o.$remaining,o.$remaining+=u.length,d(u.map(function(n){return v(b(0===n.indexOf("json!")?n:"json!"+n))}),function(){var n,e=x.apply(arguments);E(e,function(n,e){c.includes.push(n);var r=f(n.safe,f(s.safe,!1)),t=f(n.dynamic,f(s.dynamic,!0));E(n.modules,function(n){n.dynamic=f(n.dynamic,f(t,!0)),n.safe=f(n.safe,f(r,!1)),n.depends=n.depends||[]}),delete n.safe,delete n.dynamic;var a=S(u[e]).split("/");if(a.pop(),n.dir=a.length?a.join("/"):"",n.includes&&j(n.includes)){var i=n.includes.filter(function(n){return"string"==typeof n}).map(function(n){return a.length?a.concat(n).join("/"):n});n.includes=n.includes.filter(function(n){return"string"!=typeof n}),o(i,n,{dynamic:t,safe:r})}c===p?l=p.includes[0].environment||{}:A(l,n.environment||{})}),(o.$remaining-=e.length)||(h||(n=angular.module,angular.module=function(){var i=arguments[0],o=n.apply(angular,arguments);return angular.forEach(o,function(r,t){if("function"==typeof r&&"info"!==t&&"config"!==t&&"run"!==t){if(r.$$hook)return;var a=o[t]=function(){var n=arguments[0],e=N[n]=N[n]||{};return e[n]?console.warn(t+"::"+n+" in module "+i+" was already defined in "+e[n]):(e[n]=i,console.debug("define "+t+"::"+n+" in module "+i)),r.apply(o,arguments),o}.bind(o);a.$$hook=!0,angular.forEach(a,function(n,e){"function"==typeof n&&(a[e]=n)})}}),o}.bind(angular)),p=p.includes[0],A(m,{name:"APPLICATION"},l),h||console.debug("application.json:\n"+JSON.stringify(p,null,4)),function(n){var r=function e(t,a){E(a.modules||{},function(n,e){var r={language:n.language||{},script:b(n.script),templateUrl:b(n.template),extras:{dynamic:n.dynamic,safe:n.safe,deps:n.depends,path:e}};a.dir&&(r.script=w(a,r.script),r.templateUrl=w(a,r.templateUrl),E(r.language,function(n,e){r.language[e]=w(a,n)}),r.extras.path="/"+w(a,e)),r.script=v(r.script),E(r.language,function(n,e){r.language[e]=v("json!"+n)}),t.push(r)});a.includes&&E(a.includes||[],function(n){t=t.concat(e([],n))});return t}([],n),t=[function(n){y.progress("Application","prepare system modules"),m.$$config(g.depends||{});var e=g.includes||[];E(e,function(n){y.progress("Application","prepare system module > "+n)}),i(e,n)},function(n){y.progress("Application","prepare user modules");var e=[];r.filter(function(n){return n.ready=!n.extras.dynamic}).forEach(function(n){y.progress("Application","prepare user module > "+n.extras.path),o(n,e).push(n)}),i(e=e.map(function(n){return n.extras.dynamic=!1,n.script}),n)}];E(r,function(n){n.extras.path===m.layout&&((m.layout=n).extras.layout=!0,n.extras.safe=!0,n.extras.dynamic=!1)});var a=r.filter(function(n){return!n.extras.layout&&!n.templateUrl});function i(n,u){d(n,function(){var a=[],i=arguments.length,o=null;if(0==i)return u(a);x.apply(arguments).map(function(n,e,r){function t(){x.apply(arguments).forEach(function(e){e&&(a.push(e),r.forEach(function(n){e.name==n.name&&(n.resolved=!0)}))}),--i<1&&(o&&clearTimeout(o),u(a))}$(n.module)?(n.module(t),o||function n(r){n.times=0|n.times;if(10<n.times++)return;o=setTimeout(function(){n(r);var e=[];throw r.forEach(function(n){n.resolved||e.push(n.name)}),new Error("DETECTED INIT HUNG UP WITHIN 30 SECONDS.\nPlease check out following modules:\n\t"+e.join("\n\t"))},3e4)}(r)):(n.name=n.module.name,t(n.module))})})}function o(n,r){return n.extras.deps.forEach(function(e){var n=a.find(function(n){return n.extras.path===e&&n.extras.dynamic});n&&(y.progress("Application","prepare dependency module > "+e),r.push(n),o(n,r))}),r}m.routes=r.filter(function(n){return!n.extras.layout&&n.templateUrl}),m.dependModules=o,function e(r){if(t.length)t.shift()(function(n){e(r.concat(n))});else{r=r.map(function(n){return y.progress("Application","bootstrap module > "+n.name),n.name}),h||y.progress("Application","verify done");var n=document.body||document.querySelector&&document.querySelector("body");angular.bootstrap(n,r,{strictDi:!0}),y.progress("Application","ready",!0)}}([])}(p))}))}(["application.json"],p,{dynamic:!1,safe:!1})})});