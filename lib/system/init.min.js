define(["require","application"],function(n,e,r){"use strict";function t(n,e){return e&&"/"!==e[0]?a([n.dir||"",e].join("/")):e}function a(n){var e=[];return n.split("/").forEach(function(n){".."===n?e.pop():"."!==n&&e.push(n)}),e.join("/")}var o=e.uefi,i=o.prodMode,u=e.$$cacheUrl,c=(angular.bootstrap,angular.forEach),s=angular.merge,l=Array.prototype.slice,p=angular.isFunction,f=angular.isArray,d=angular.isDefined,m=angular.isString,g=function(n,e){if(!e)return e;for(var r=/\$\{([a-zA-Z\.\-0-9/]+)\}/g,t=0;t<100;t++){var a=r.exec(e);if(!a)return e;var o=n[a[1]];if(!o||!m(o))throw new Error("CANNT RESOLVE VAR `"+a+"`");e=e.replace(r,o)}throw new Error("TO MANY LEVELS IN VAR RESOLVE.")},y={};o.progress("Application","loading"),n([u("json!lib/system/etc/module.json")],function(m){function h(n,e){return d(n)?n:e}var v,E={includes:[]},A={};r=m,function d(m,x,$){m.length&&(d.$remaining=0|d.$remaining,d.$remaining+=m.length,n(m.map(function(n){return u(g(e,0===n.indexOf("json!")?n:"json!"+n))}),function(){var j=l.apply(arguments);c(j,function(n,e){x.includes.push(n);var r=h(n.safe,h($.safe,!1)),o=h(n.dynamic,h($.dynamic,!0));c(n.modules,function(n){n.dynamic=h(n.dynamic,h(o,!0)),n.safe=h(n.safe,h(r,!1)),n.depends=n.depends||[]}),delete n.safe,delete n.dynamic;var i=a(m[e]).split("/");if(i.pop(),n.dir=i.length?i.join("/"):"",n.includes&&f(n.includes)){var u=n.includes.filter(function(n){return"string"==typeof n}).map(function(n){return i.length?i.concat(n).join("/"):n});n.includes=n.includes.filter(function(n){return"string"!=typeof n}),d(u,n,{dynamic:o,safe:r})}x===E?v=E.includes[0].environment||{}:(s(v,n.environment||{}),delete n.environment),c(n.modules||{},function(e,r){function a(n,e){return n?e?"/"!==n[0]?"/"+n:n:"/"===n[0]?n.substr(1):n:n}e.script=a(t(n,g(v,e.script))),e.template=a(t(n,g(v,e.template))),c(e.language||{},function(r,o){e.language[o]=a(t(n,r))}),A[a(t(n,r),!0)]=e}),delete n.dir});(d.$remaining-=j.length)||(i||function(){var n=angular.module;angular.module=function(){var e=arguments[0],r=n.apply(angular,arguments);return angular.forEach(r,function(n,t){if("function"==typeof n&&"info"!==t&&"config"!==t&&"run"!==t){if(n.$$hook)return;var a=r[t]=function(){var a=arguments[0],o=y[a]=y[a]||{};return o[a]?console.warn(t+"::"+a+" in module "+e+" was already defined in "+o[a]):(o[a]=e,console.debug("define "+t+"::"+a+" in module "+e)),n.apply(r,arguments),r}.bind(r);a.$$hook=!0,angular.forEach(a,function(n,e){"function"==typeof n&&(a[e]=n)})}}),r}.bind(angular)}(),s(e,{name:"APPLICATION"},v),E={environment:v,modules:A},i||console.debug("application.json:\n"+JSON.stringify(E,null,4)),function(t){function a(e,r){n(e,function(){function n(e){n.times=0|n.times,n.times++>10||(a=setTimeout(function(){n(e);var r=[];throw e.forEach(function(n){n.resolved||r.push(n.name)}),new Error("DETECTED INIT HUNG UP WITHIN 30 SECONDS.\nPlease check out following modules:\n\t"+r.join("\n\t"))},3e4))}var e=[],t=arguments.length,a=null;if(0==t)return r(e);l.apply(arguments).map(function(o,i,u){function c(){l.apply(arguments).forEach(function(n){n&&(e.push(n),u.forEach(function(e){n.name==e.name&&(e.resolved=!0)}))}),--t<1&&(a&&clearTimeout(a),r(e))}p(o.module)?(o.module(c),a||n(u)):(o.name=o.module.name,c(o.module))})})}function s(n,e){return n.extras.deps.forEach(function(n){var r=m.find(function(e){return e.extras.path===n&&e.extras.dynamic});r&&(o.progress("Application","prepare dependency module > "+n),e.push(r),s(r,e))}),e}var f=function(n,e){return c(t.modules||{},function(e,r){var t={language:e.language||{},script:u(e.script),templateUrl:e.template,extras:{dynamic:e.dynamic,safe:e.safe,deps:e.depends,path:r}};c(t.language,function(n,e){t.language[e]=u("json!"+n)}),n.push(t)}),n}([]),d=[function(n){o.progress("Application","prepare system modules"),e.$$config(r.depends||{});var t=r.includes||[];c(t,function(n){o.progress("Application","prepare system module > "+n)}),a(t,n)},function(n){o.progress("Application","prepare user modules");var e=[];f.filter(function(n){return n.ready=!n.extras.dynamic}).forEach(function(n){o.progress("Application","prepare user module > "+n.extras.path),s(n,e).push(n)}),a(e=e.map(function(n){return n.extras.dynamic=!1,n.script}),n)}];c(f,function(n){n.extras.path===e.layout&&(e.layout=n,n.extras.layout=!0,n.extras.safe=!0,n.extras.dynamic=!1)});var m=f.filter(function(n){return!n.extras.layout&&!n.templateUrl});e.routes=f.filter(function(n){return!n.extras.layout&&n.templateUrl}),e.dependModules=s,function n(e){if(d.length)d.shift()(function(r){n(e.concat(r))});else{e=e.map(function(n){return o.progress("Application","bootstrap module > "+n.name),n.name}),i||o.progress("Application","verify done");var r=document.body||document.querySelector&&document.querySelector("body");angular.bootstrap(r,e,{strictDi:!0}),o.progress("Application","ready",!0)}}([])}(E))}))}(["application.json"],E,{dynamic:!1,safe:!1})})});