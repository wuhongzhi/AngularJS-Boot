define(["require","application"],function(n,e,r){"use strict";function t(n,e){return e&&"/"!=e[0]?a([n.dir,e].join("/")):e}function a(n){var e=[];return n.split("/").forEach(function(n){".."===n?e.pop():"."!==n&&e.push(n)}),e.join("/")}var i=e.uefi,o=e.$$cacheUrl,u=(angular.bootstrap,angular.forEach),s=angular.merge,c=Array.prototype.slice,l=angular.isFunction,p=angular.isArray,f=angular.isDefined,d=angular.isString,m=function(n){if(!n)return n;for(var r=/\$\{([a-zA-Z\.\-0-9/]+)\}/g,t=0;t<100;t++){var a=r.exec(n);if(!a)return n;var i=e[a[1]];if(!i||!d(i))throw new Error("CANNT RESOLVE VAR `"+a+"`");n=n.replace(r,i)}throw new Error("TO MANY LEVELS IN VAR RESOLVE.")};setTimeout(function(){i.progress("Application","loading"),n([o("json!lib/system/etc/module.json")],function(d){function g(n,e){return f(n)?n:e}var h,y={includes:[],dynamic:!1,safe:!1};r=d,function f(d,v){d.length&&(f.$remaining=0|f.$remaining,f.$remaining+=d.length,n(d.map(function(n){return o(m(0===n.indexOf("json!")?n:"json!"+n))}),function(){var E=c.apply(arguments);u(E,function(n,e){v.includes.push(n),n.dynamic=g(n.dynamic,g(v.dynamic,!0)),n.safe=g(n.safe,g(v.safe,!1)),u(n.modules,function(e){e.dynamic=g(e.dynamic,g(n.dynamic,!0)),e.safe=g(e.safe,g(n.safe,!1)),e.depends=e.depends||[]});var r=a(d[e]).split("/");if(r.pop(),n.dir=r.length?r.join("/"):"",n.includes&&p(n.includes)){var t=n.includes.map(function(n){return r.length?r.concat(n).join("/"):n});n.includes=[],f(t,n)}v===y?h=y.includes[0].environment||{}:s(h,n.environment||{})});(f.$remaining-=E.length)||(y=y.includes[0],s(e,{name:"APPLICATION"},h),function(a){function s(e,r){n(e,function(){function n(e){n.times=0|n.times,n.times++>10||(a=setTimeout(function(){n(e);var r=[];throw e.forEach(function(n){n.resolved||r.push(n.name)}),new Error("DETECTED INIT HUNG UP WITHIN 30 SECONDS.\nPlease check out following modules:\n\t"+r.join("\n\t"))},3e4))}var e=[],t=arguments.length,a=null;if(0==t)return r(e);c.apply(arguments).map(function(i,o,u){function s(){c.apply(arguments).forEach(function(n){n&&(e.push(n),u.forEach(function(e){n.name==e.name&&(e.resolved=!0)}))}),--t<1&&(a&&clearTimeout(a),r(e))}l(i.module)?(i.module(s),a||n(u)):(i.name=i.module.name,s(i.module))})})}function p(n,e){return u(e.modules||{},function(r,a){var i={language:r.language||{},script:m(r.script),templateUrl:m(r.template),extras:{dynamic:r.dynamic,safe:r.safe,deps:r.depends,path:a}};e.dir&&(i.script=t(e,i.script),i.templateUrl=t(e,i.templateUrl),u(i.language,function(n,r){i.language[r]=t(e,n)}),i.extras.path="/"+t(e,a)),i.script=o(i.script),u(i.language,function(n,e){i.language[e]=o("json!"+n)}),n.push(i)}),e.includes&&u(e.includes||[],function(e){n=n.concat(p([],e))}),n}function f(n,e){return n.extras.deps.forEach(function(n){var r=h.find(function(e){return e.extras.path===n&&e.extras.dynamic});r&&(i.progress("Application","prepare dependency module > "+n),e.push(r),f(r,e))}),e}var d=p([],a),g=[function(n){i.progress("Application","prepare system modules"),e.$$config(r.depends||{});var t=r.includes||[];u(t,function(n){i.progress("Application","prepare system module > "+n)}),s(t,n)},function(n){i.progress("Application","prepare user modules");var e=[];d.filter(function(n){return n.ready=!n.extras.dynamic}).forEach(function(n){i.progress("Application","prepare user module > "+n.extras.path),f(n,e).push(n)}),s(e=e.map(function(n){return n.extras.dynamic=!1,n.script}),n)}];u(d,function(n){n.extras.path===e.layout&&(e.layout=n,n.extras.layout=!0,n.extras.safe=!0,n.extras.dynamic=!1)});var h=d.filter(function(n){return!n.extras.layout&&!n.templateUrl});e.routes=d.filter(function(n){return!n.extras.layout&&n.templateUrl}),e.dependModules=f,function n(e){g.length?g.shift()(function(r){n(e.concat(r))}):(e=e.map(function(n){return i.progress("Application","bootstrap module > "+n.name),n.name}),angular.bootstrap(document,e,{strictDi:!0}),i.progress("Application","ready",!0))}([])}(y))}))}(["application.json"],y)})})});