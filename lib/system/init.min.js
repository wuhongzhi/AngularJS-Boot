define(["require","application"],function(h,v,E){"use strict";var A=v.uefi,x=A.prodMode,$=v.$$cacheUrl,j=(angular.bootstrap,angular.forEach),b=angular.merge,N=Array.prototype.slice,w=angular.isFunction,S=angular.isArray,r=angular.isDefined,o=angular.isString,T={};A.progress("Application","loading"),h([$("json!lib/system/etc/module.json")],function(n){var s,f={includes:[]},p={};function d(n,e){if(!e)return e;for(var r=/\$\{([a-zA-Z\.\-0-9/]+)\}/g,t=0;t<100;t++){var a=r.exec(e);if(!a)return e;var i=n[a[1]];if(!i||!o(i))throw new Error("CANNT RESOLVE VAR `"+a+"`");e=e.replace(r,i)}throw new Error("TO MANY LEVELS IN VAR RESOLVE.")}function m(n,e){return r(n)?n:e}function g(n,e){return e&&"/"!==e[0]?y([n.dir||"",e].join("/")):e}function y(n){var e=[];return n.split("/").forEach(function(n){".."===n?e.pop():"."!==n&&e.push(n)}),e.join("/")}E=n,function o(u,c,l){u.length&&(o.$remaining=0|o.$remaining,o.$remaining+=u.length,h(u.map(function(n){return $(d(v,0===n.indexOf("json!")?n:"json!"+n))}),function(){var n,e=N.apply(arguments);j(e,function(a,n){c.includes.push(a),c===f?(s=f.includes[0].environment||{},l.safe=!!s.safe,l.dynamic=!!s.dynamic):(b(s,a.environment||{}),delete a.environment);var e=m(a.safe,m(l.safe,!1)),r=m(a.dynamic,m(l.dynamic,!0));j(a.modules,function(n){n.safe=m(n.safe,m(e,!1)),n.dynamic=m(n.dynamic,m(r,!0))}),delete a.safe,delete a.dynamic;var t,i=y(u[n]).split("/");i.pop(),a.dir=i.length?i.join("/"):"",a.includes&&S(a.includes)&&(t=a.includes.filter(function(n){return"string"==typeof n}).map(function(n){return i.length?i.concat(n).join("/"):n}),a.includes=a.includes.filter(function(n){return"string"!=typeof n}),o(t,a,{dynamic:r,safe:e})),j(a.modules||{},function(r,n){function t(n,e){return n?e?"/"!==n[0]?"/"+n:n:"/"===n[0]?n.substr(1):n:n}r.script=t(g(a,d(s,r.script))),r.template=t(g(a,d(s,r.template))),j(r.language||{},function(n,e){r.language[e]=t(g(a,n))}),p[t(g(a,n),!0)]=r}),delete a.dir}),(o.$remaining-=e.length)||(x||(n=angular.module,angular.module=function(){var i=arguments[0],o=n.apply(angular,arguments);return angular.forEach(o,function(r,t){if("function"==typeof r&&"info"!==t&&"config"!==t&&"run"!==t){if(r.$$hook)return;var a=o[t]=function(){var n=arguments[0],e=T[n]=T[n]||{};return e[n]?console.warn(t+"::"+n+" in module "+i+" was already defined in "+e[n]):(e[n]=i,console.debug("define "+t+"::"+n+" in module "+i)),r.apply(o,arguments),o}.bind(o);a.$$hook=!0,angular.forEach(a,function(n,e){"function"==typeof n&&(a[e]=n)})}}),o}.bind(angular)),b(v,{name:"APPLICATION"},s),f={environment:s,modules:p},x||console.debug("application.json:\n"+JSON.stringify(f,null,4)),function(n){var r=function(t,n){return j(n.modules||{},function(n,e){var r={language:n.language||{},script:$(n.script),templateUrl:n.template,extras:{path:e,deps:n.depends||[],safe:n.safe,dynamic:n.dynamic}};j(r.language,function(n,e){r.language[e]=$("json!"+n)}),t.push(r)}),t}([],n),t=[function(n){A.progress("Application","prepare system modules"),v.$$config(E.depends||{});var e=E.includes||[];j(e,function(n){A.progress("Application","prepare system module > "+n)}),i(e,n)},function(n){A.progress("Application","prepare user modules");var e=[];r.filter(function(n){return n.ready=!n.extras.dynamic}).forEach(function(n){A.progress("Application","prepare user module > "+n.extras.path),o(n,e).push(n)}),i(e=e.map(function(n){return n.extras.dynamic=!1,n.script}).filter(function(n){return!!n}),n)}];j(r,function(n){n.extras.path===v.layout&&((v.layout=n).extras.layout=!0,n.extras.safe=!0,n.extras.dynamic=!1)});var a=r.filter(function(n){return!n.extras.layout&&!n.templateUrl});function i(n,c){h(n,function(){var a=[],i=arguments.length,o=null;if(0==i)return c(a);function u(n){u.times=0|u.times,10<u.times++||(o=setTimeout(function(){u(n);var e=[];throw n.forEach(function(n){n.resolved||e.push(n.name)}),new Error("DETECTED INIT HUNG UP WITHIN 30 SECONDS.\nPlease check out following modules:\n\t"+e.join("\n\t"))},3e4))}N.apply(arguments).map(function(n,e,r){function t(){N.apply(arguments).forEach(function(e){e&&(a.push(e),r.forEach(function(n){e.name==n.name&&(n.resolved=!0)}))}),--i<1&&(o&&clearTimeout(o),c(a))}w(n.module)?(n.module(t),o||u(r)):(n.name=n.module.name,t(n.module))})})}function o(n,r){return n.extras.deps.forEach(function(e){var n=a.find(function(n){return n.extras.path===e&&n.extras.dynamic});n&&(A.progress("Application","prepare dependency module > "+e),r.push(n),o(n,r))}),r}v.routes=r.filter(function(n){return!n.extras.layout&&n.templateUrl}),v.languages=a.filter(function(n){return!n.script&&n.language}),v.dependModules=o,function e(r){var n;t.length?t.shift()(function(n){e(r.concat(n))}):(r=r.map(function(n){return A.progress("Application","bootstrap module > "+n.name),n.name}),x||A.progress("Application","verify done"),n=document.body||document.querySelector&&document.querySelector("body"),angular.bootstrap(n,r,{strictDi:!0}),A.progress("Application","ready",!0))}([])}(f))}))}(["application.json"],f,{dynamic:!1,safe:!1})})});