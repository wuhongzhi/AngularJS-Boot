define(["require","application"],function(n,e,r){"use strict";function t(n){var e=[];return n.split("/").forEach(function(n){".."===n?e.pop():"."!==n&&e.push(n)}),e.join("/")}var a=e.uefi,i=e.$$cacheUrl,o=(angular.bootstrap,angular.forEach),u=angular.merge,s=Array.prototype.slice,c=angular.isFunction,l=angular.isArray,p=angular.isDefined,f=angular.isString,d=function(n){if(!n)return n;for(var r=/\$\{([a-zA-Z\.\-0-9/]+)\}/g,t=0;t<100;t++){var a=r.exec(n);if(!a)return n;var i=e[a[1]];if(!i||!f(i))throw new Error("CANNT RESOLVE VAR `"+a+"`");n=n.replace(r,i)}throw new Error("TO MANY LEVELS IN VAR RESOLVE.")};setTimeout(function(){a.progress("Application","loading"),n([i("json!lib/system/modules/configuration.json")],function(f){function m(n,e){return p(n)?n:e}var g,h={includes:[],dynamic:!1,safe:!1};r=f,function p(f,y){f.length&&(p.$remaining=0|p.$remaining,p.$remaining+=f.length,n(f.map(function(n){return i(d(0===n.indexOf("json!")?n:"json!"+n))}),function(){var v=s.apply(arguments);o(v,function(n,e){y.includes.push(n),n.dynamic=m(n.dynamic,m(y.dynamic,!0)),n.safe=m(n.safe,m(y.safe,!1)),o(n.modules,function(e){e.dynamic=m(e.dynamic,m(n.dynamic,!0)),e.safe=m(e.safe,m(n.safe,!1)),e.depends=e.depends||[]});var r=t(f[e]).split("/");if(r.pop(),n.dir=r.length?r.join("/"):"",n.includes&&l(n.includes)){var a=n.includes.map(function(n){return r.length?r.concat(n).join("/"):n});n.includes=[],p(a,n)}y===h?g=h.includes[0].environment||{}:u(g,n.environment||{})});(p.$remaining-=v.length)||(h=h.includes[0],u(e,{name:"APPLICATION"},g),function(u){function l(e,r){n(e,function(){function n(e){n.times=0|n.times,n.times++>10||(a=setTimeout(function(){n(e);var r=[];throw e.forEach(function(n){n.resolved||r.push(n.name)}),new Error("DETECTED INIT HUNG UP WITHIN 30 SECONDS.\nPlease check out following modules:\n\t"+r.join("\n\t"))},3e4))}var e=[],t=arguments.length,a=null;if(0==t)return r(e);s.apply(arguments).map(function(i,o,u){function l(){s.apply(arguments).forEach(function(n){n&&(e.push(n),u.forEach(function(e){n.name==e.name&&(e.resolved=!0)}))}),--t<1&&(a&&clearTimeout(a),r(e))}c(i.module)?(i.module(l),a||n(u)):(i.name=i.module.name,l(i.module))})})}function p(n,e){return o(e.modules||{},function(r,t){var a={language:r.language||{},script:d(r.script),templateUrl:d(r.template),extras:{dynamic:r.dynamic,safe:r.safe,deps:r.depends,path:t}};e.dir&&(a.script=m(e,a.script),a.templateUrl=m(e,a.templateUrl),o(a.language,function(n,r){a.language[r]=m(e,n)}),a.extras.path="/"+m(e,t)),a.script=i(a.script),o(a.language,function(n,e){a.language[e]=i("json!"+n)}),n.push(a)}),e.includes&&o(e.includes||[],function(e){n=n.concat(p([],e))}),n}function f(n,e){return n.extras.deps.forEach(function(n){var r=y.find(function(e){return e.extras.path===n&&e.extras.dynamic});r&&(a.progress("Application","prepare dependency module > "+n),e.push(r),f(r,e))}),e}function m(n,e){return e&&"/"!=e[0]?t([n.dir,e].join("/")):e}var g=p([],u),h=[function(n){a.progress("Application","prepare system modules"),e.$$config(r.depends||{});var t=r.includes||[];o(t,function(n){a.progress("Application","prepare system module > "+n)}),l(t,n)},function(n){a.progress("Application","prepare user modules");var e=[];g.filter(function(n){return n.ready=!n.extras.dynamic}).forEach(function(n){a.progress("Application","prepare user module > "+n.extras.path),f(n,e).push(n)}),l(e=e.map(function(n){return n.extras.dynamic=!1,n.script}),n)}];o(g,function(n){n.extras.path===e.layout&&(e.layout=n,n.extras.layout=!0,n.extras.safe=!0,n.extras.dynamic=!1)});var y=g.filter(function(n){return!n.extras.layout&&!n.templateUrl});e.routes=g.filter(function(n){return!n.extras.layout&&n.templateUrl}),e.dependModules=f,function n(e){h.length?h.shift()(function(r){n(e.concat(r))}):(e=e.map(function(n){return a.progress("Application","bootstrap module > "+n.name),n.name}),angular.bootstrap(document,e,{strictDi:!0}),a.progress("Application","ready",!0))}([])}(h))}))}(["application.json"],h)})})});