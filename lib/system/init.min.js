define(["require","application"],function(e,l,p){"use strict";var u=l.uefi,f=u.prodMode,d=l.$$cacheUrl,m=(angular.bootstrap,angular.forEach),g=angular.merge,h=Array.prototype.slice,s=angular.isFunction,y=angular.isArray,r=angular.isDefined,i=angular.isString,v=function(n){if(!n)return n;for(var e=/\$\{([a-zA-Z\.\-0-9/]+)\}/g,r=0;r<100;r++){var a=e.exec(n);if(!a)return n;var t=l[a[1]];if(!t||!i(t))throw new Error("CANNT RESOLVE VAR `"+a+"`");n=n.replace(e,t)}throw new Error("TO MANY LEVELS IN VAR RESOLVE.")},E={warns:[],infos:[],keys:{}};function a(n){var r=function e(a,t){m(t.modules||{},function(n,e){var r={language:n.language||{},script:v(n.script),templateUrl:v(n.template),extras:{dynamic:n.dynamic,safe:n.safe,deps:n.depends,path:e}};t.dir&&(r.script=c(t,r.script),r.templateUrl=c(t,r.templateUrl),m(r.language,function(n,e){r.language[e]=c(t,n)}),r.extras.path="/"+c(t,e)),r.script=d(r.script),m(r.language,function(n,e){r.language[e]=d("json!"+n)}),a.push(r)});t.includes&&m(t.includes||[],function(n){a=a.concat(e([],n))});return a}([],n),a=[function(n){u.progress("Application","prepare system modules"),l.$$config(p.depends||{});var e=p.includes||[];m(e,function(n){u.progress("Application","prepare system module > "+n)}),i(e,n)},function(n){u.progress("Application","prepare user modules");var e=[];r.filter(function(n){return n.ready=!n.extras.dynamic}).forEach(function(n){u.progress("Application","prepare user module > "+n.extras.path),o(n,e).push(n)}),i(e=e.map(function(n){return n.extras.dynamic=!1,n.script}),n)}];m(r,function(n){n.extras.path===l.layout&&((l.layout=n).extras.layout=!0,n.extras.safe=!0,n.extras.dynamic=!1)});var t=r.filter(function(n){return!n.extras.layout&&!n.templateUrl});function i(n,u){e(n,function(){var t=[],i=arguments.length,o=null;if(0==i)return u(t);h.apply(arguments).map(function(n,e,r){function a(){h.apply(arguments).forEach(function(e){e&&(t.push(e),r.forEach(function(n){e.name==n.name&&(n.resolved=!0)}))}),--i<1&&(o&&clearTimeout(o),u(t))}s(n.module)?(n.module(a),o||function n(r){n.times=0|n.times;if(10<n.times++)return;o=setTimeout(function(){n(r);var e=[];throw r.forEach(function(n){n.resolved||e.push(n.name)}),new Error("DETECTED INIT HUNG UP WITHIN 30 SECONDS.\nPlease check out following modules:\n\t"+e.join("\n\t"))},3e4)}(r)):(n.name=n.module.name,a(n.module))})})}function o(n,r){return n.extras.deps.forEach(function(e){var n=t.find(function(n){return n.extras.path===e&&n.extras.dynamic});n&&(u.progress("Application","prepare dependency module > "+e),r.push(n),o(n,r))}),r}l.routes=r.filter(function(n){return!n.extras.layout&&n.templateUrl}),l.dependModules=o,function e(r){a.length?a.shift()(function(n){e(r.concat(n))}):(r=r.map(function(n){return u.progress("Application","bootstrap module > "+n.name),n.name}),f||(E.infos.sort().forEach(function(n){console.debug(n)}),E.warns.sort().forEach(function(n){console.warn(n)}),u.progress("Application","verify done",!0)),angular.bootstrap(document,r,{strictDi:!0}),u.progress("Application","ready",!0))}([])}function c(n,e){return e&&"/"!=e[0]?A([n.dir,e].join("/")):e}function A(n){var e=[];return n.split("/").forEach(function(n){".."===n?e.pop():"."!==n&&e.push(n)}),e.join("/")}setTimeout(function(){u.progress("Application","loading"),e([d("json!lib/system/etc/module.json")],function(n){var u,s={includes:[],dynamic:!1,safe:!1};function c(n,e){return r(n)?n:e}p=n,function t(i,o){i.length&&(t.$remaining=0|t.$remaining,t.$remaining+=i.length,e(i.map(function(n){return d(v(0===n.indexOf("json!")?n:"json!"+n))}),function(){var n,e=h.apply(arguments);m(e,function(e,n){o.includes.push(e),e.dynamic=c(e.dynamic,c(o.dynamic,!0)),e.safe=c(e.safe,c(o.safe,!1)),m(e.modules,function(n){n.dynamic=c(n.dynamic,c(e.dynamic,!0)),n.safe=c(n.safe,c(e.safe,!1)),n.depends=n.depends||[]});var r=A(i[n]).split("/");if(r.pop(),e.dir=r.length?r.join("/"):"",e.includes&&y(e.includes)){var a=e.includes.map(function(n){return r.length?r.concat(n).join("/"):n});e.includes=[],t(a,e)}o===s?u=s.includes[0].environment||{}:g(u,e.environment||{})}),(t.$remaining-=e.length)||(f||(n=angular.module,angular.module=function(){var i=arguments[0],o=n.apply(angular,arguments);return angular.forEach(o,function(r,a){if("function"==typeof r&&"info"!==a&&"config"!==a&&"run"!==a){if(r.$$hook)return;var t=o[a]=function(){var n=arguments[0],e=E.keys[n]=E.keys[n]||{};return e[n]?E.warns.push(a+"::"+n+" in module "+i+" was already defined in "+e[n]):(e[n]=i,E.infos.push("define "+a+"::"+n+" in module "+i)),r.apply(o,arguments),o}.bind(o);t.$$hook=!0,angular.forEach(t,function(n,e){"function"==typeof n&&(t[e]=n)})}}),o}.bind(angular)),s=s.includes[0],g(l,{name:"APPLICATION"},u),a(s))}))}(["application.json"],s)})})});