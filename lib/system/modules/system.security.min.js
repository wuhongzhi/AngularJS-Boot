define(["require","exports","application"],function(e,t,n){var r=t.module=angular.module("system.security",["ng","ngResource","system.http"]),f={xsrfCookieName:"XSRF-TOKEN"},l={},d=null,u=n.uefi,a=n.routes;r.config(["$compileProvider","$httpProvider",function(e,t){u.progress("Application","setup system.security"),f=angular.merge(f,t.defaults),u.prodMode&&(e.debugInfoEnabled(!1),angular.reloadWithDebugInfo=angular.noop),delete window.jQuery,delete window.$}]).run(["$rootScope","securityService",function(e,u){e.security=u,e.$on("$routeChangeStart",function(e,t,n){var r=t.$$route;r&&r.extras.safe||r&&u.canRead(r.originalPath)||e.preventDefault()})}]).factory("authenticationService",["$resource","$rootScope","httpService","securityService",function(u,a,i,o){var c;return c={authenticate:function(e,t,n){var r={user:e,password:t};angular.equals(d,r)||u("authenticate").create(r,function(e){s(e,r)},function(e){c.deauthenticate(),angular.isFunction(n)&&n(e)})},deauthenticate:function(){null!=d&&u("authenticate").delete(function(){d=null,l={},i.setXSRFToken(null),a.$broadcast(o.UNSECURED)})},confirm:function(e){var t={confirm:e};u("authenticate").update(t,function(e){s(e,t)},c.deauthenticate)}};function s(e,t){d=t,l=angular.extend({},e.permissions||{}),i.setXSRFToken(e[f.xsrfCookieName]);var n=[];for(var r in e.menus)o.canRead(e.menus[r],o.ACL.READ)&&n.push(e.menus[r]);a.$broadcast(o.ENFORCED,n)}}]).provider("securityService",[function(){var r=angular.isUndefined,u={CREATE:"C",READ:"R",MODIFY:"U",DELETE:"D"};this.acl=function(e){if(r(e))return u;u=e},this.$get=["$route",function(t){var n;return n={ACL:u,ENFORCED:"security.enforced",UNSECURED:"security.unsecured",hasPermission:function(t,e){if(a.filter(function(e){return e.extras.path===t}).length<1)return!1;if(r(t))return!1;var n=l[t];return!r(n)&&(r(e)?0<n.length:-1!=n.indexOf(e.toUpperCase()))},canCreate:function(e){return e=e||t.current&&t.current.$$route.extras.path,n.hasPermission(e,n.ACL.CREATE)},canRead:function(e){return e=e||t.current&&t.current.$$route.extras.path,n.hasPermission(e,n.ACL.READ)},canModify:function(e){return e=e||t.current&&t.current.$$route.extras.path,n.hasPermission(e,n.ACL.MODIFY)},canDelete:function(e){return e=e||t.current&&t.current.$$route.extras.path,n.hasPermission(e,n.ACL.DELETE)},canChange:function(e){return e=e||t.current&&t.current.$$route.extras.path,n.canCreate(e)||n.canModify(e)||n.canDelete(e)}}}]}])});