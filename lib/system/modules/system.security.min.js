define(["require","exports","application"],function(e,n,t){var r=n.module=angular.module("system.security",["ng","ngResource","system.http"]),s={xsrfCookieName:"XSRF-TOKEN"},f={},l=null,i=t.uefi,a=t.routes;r.config(["$compileProvider","$httpProvider",function(e,n){i.progress("Application","setup system.security"),s=angular.merge(s,n.defaults),i.prodMode&&(e.debugInfoEnabled(!1),angular.reloadWithDebugInfo=angular.noop),delete window.jQuery,delete window.$}]).run(["$rootScope","securityService",function(e,i){e.security=i,e.$on("$routeChangeStart",function(e,n,t){var r=n.$$route;r&&r.extras.safe||r&&i.canRead(r.originalPath)||e.preventDefault()})}]).factory("authenticationService",["$resource","$rootScope","httpService","securityService",function(r,i,a,u){var o;return o={authenticate:function(e,n){var t={user:e,password:n};angular.equals(l,t)||r("authenticate").create(t,function(e){c(e,t)},o.deauthenticate)},deauthenticate:function(){null!=l&&r("authenticate/cancel").create(function(){l=null,f={},a.setXSRFToken(null),i.$broadcast(u.UNSECURED)})},confirm:function(e){var n={confirm:e};r("authenticate/confirm").create(n,function(e){c(e,n)},o.deauthenticate)}};function c(e,n){l=n,f=angular.extend({},e.permissions||{}),a.setXSRFToken(e[s.xsrfCookieName]);var t=[];for(var r in f)u.canRead(r,u.ACL.READ)&&t.push(r);i.$broadcast(u.ENFORCED,t)}}]).provider("securityService",[function(){var r=angular.isUndefined,t={CREATE:"C",READ:"R",MODIFY:"U",DELETE:"D"};this.acl=function(e){if(r(e))return t;t=e},this.$get=function(){var n;return n={ACL:t,ENFORCED:"security.enforced",UNSECURED:"security.unsecured",hasPermission:function(n,e){if(a.filter(function(e){return e.extras.path===n}).length<1)return!1;if(r(n))return!1;var t=f[n];return!r(t)&&(r(e)?0<t.length:-1!=t.indexOf(e.toUpperCase()))},canCreate:function(e){return n.hasPermission(e,n.ACL.CREATE)},canRead:function(e){return n.hasPermission(e,n.ACL.READ)},canModify:function(e){return n.hasPermission(e,n.ACL.MODIFY)},canDelete:function(e){return n.hasPermission(e,n.ACL.DELETE)}}}}])});