define(["require","exports","application"],function(e,n,t){var r=n.module=angular.module("system.security",["ng","ngResource","system.http"]),u={xsrfCookieName:"XSRF-TOKEN"},s={},f=null,a=t.uefi,i=t.routes;r.config(["$compileProvider","$httpProvider",function(e,n){a.progress("Application","setup system.security"),u=angular.merge(u,n.defaults),a.prodMode&&(e.debugInfoEnabled(!1),angular.reloadWithDebugInfo=angular.noop),delete window.jQuery,delete window.$}]).run(["$rootScope","securityService",function(e,u){e.security=u,e.$on("$routeChangeStart",function(e,n,t){var r=n.$$route;r&&r.extras.safe||r&&u.canRead(r.originalPath)||e.preventDefault()})}]).factory("authenticationService",["$resource","$rootScope","httpService","securityService",function(u,r,a,i){var o;return o={authenticate:function(e,n,t){var r={username:e,password:n};angular.equals(f,r)||u("authentication").create(r,function(e){c(e,r)},function(e){o.deauthenticate(),angular.isFunction(t)&&t(e)})},deauthenticate:function(){null!=f&&u("authentication").delete(function(){f=null,s={},a.setXSRFToken(null),r.$broadcast(i.UNSECURED)})},confirm:function(e){var n={confirm:e};u("authentication").modify(n,function(e){c(e,n)},o.deauthenticate)}};function c(e,n){f=n,s={};var t=[];angular.forEach(e.permissions||[],function(e){e.rights.length&&(s[e.module]=e.rights)}),angular.forEach(e.permissions||[],function(e){i.canRead(e.module,i.ACL.READ)&&t.push(e.module)}),a.setXSRFToken(e.xsrfToken),r.$broadcast(i.ENFORCED,t)}}]).provider("securityService",[function(){var r=angular.isUndefined,u={CREATE:"C",READ:"R",MODIFY:"U",DELETE:"D"};this.acl=function(e){if(r(e))return u;u=e},this.$get=["$route",function(n){var t;return t={ACL:u,ENFORCED:"security.enforced",UNSECURED:"security.unsecured",hasPermission:function(n,e){if(i.filter(function(e){return e.extras.path===n}).length<1)return!1;if(r(n))return!1;var t=s[n];return!r(t)&&(r(e)?0<t.length:-1!=t.indexOf(e))},canCreate:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.hasPermission(e,t.ACL.CREATE)},canRead:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.hasPermission(e,t.ACL.READ)},canModify:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.hasPermission(e,t.ACL.MODIFY)},canDelete:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.hasPermission(e,t.ACL.DELETE)},canChange:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.canCreate(e)||t.canModify(e)||t.canDelete(e)}}}]}])});