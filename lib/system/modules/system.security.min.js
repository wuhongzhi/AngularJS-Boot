define(["require","exports","application"],function(e,n,t){var r=n.module=angular.module("system.security",["ng","ngResource","system.http"]),i={xsrfCookieName:"XSRF-TOKEN"},o={},a=null,u=t.uefi;r.config(["$compileProvider","$httpProvider",function(e,n){u.progress("Application","setup system.security"),i=angular.merge(i,n.defaults),u.prodMode&&(e.debugInfoEnabled(!1),angular.reloadWithDebugInfo=angular.noop),delete window.jQuery,delete window.$}]).run(["$rootScope","securityService",function(e,n){e.security=n,e.$on("$routeChangeStart",function(e,t,r){var i=t.$$route;i&&i.extras.safe||i&&n.canRead(i.originalPath)||e.preventDefault()})}]).factory("authenticationService",["$resource","$rootScope","httpService","securityService",function(e,n,t,r){function u(e,u){a=u,o=angular.extend({},e.permissions||{}),t.setXSRFToken(e[i.xsrfCookieName]),n.$broadcast(r.ENFORCED)}var c,s=e("authenticate",null,{authenticate:{method:"POST"}}),f=e("authenticate.confirm",null,{confirm:{method:"POST"}});return c={authenticate:function(e,n){var t={user:e,password:n};angular.equals(a,t)||s.authenticate(t,function(e){u(e,t)},c.deauthenticate)},deauthenticate:function(){a=null,o={},t.setXSRFToken(null),n.$broadcast(r.UNSECURED)},confirm:function(e){var n={confirm:e};f.confirm(n,function(e){u(e,n)},c.deauthenticate)}}}]).provider("securityService",[function(){var e=angular.isUndefined,n={CREATE:"C",READ:"R",MODIFY:"U",DELETE:"D"};this.acl=function(t){if(e(t))return n;n=t},this.$get=function(){var t;return t={ACL:n,ENFORCED:"security.enforced",UNSECURED:"security.unsecured",hasPermission:function(n,t){if(e(n))return!1;var r=o[n];return!e(r)&&(e(t)?r.length>0:-1!=r.indexOf(t.toUpperCase()))},canCreate:function(e){return t.hasPermission(e,t.ACL.CREATE)},canRead:function(e){return t.hasPermission(e,t.ACL.READ)},canModify:function(e){return t.hasPermission(e,t.ACL.MODIFY)},canDelete:function(e){return t.hasPermission(e,t.ACL.DELETE)}}}}])});