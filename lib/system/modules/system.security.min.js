define(["require","exports","application"],function(e,n,t){var r=n.module=angular.module("system.security",["ng","ngResource","system.http"]),s={xsrfHeaderName:"X-XSRF-TOKEN"},f={},l=null,u=t.uefi,a=t.routes;r.config(["$compileProvider","$httpProvider",function(e,n){u.progress("Application","setup system.security"),s=angular.merge(s,n.defaults),u.prodMode&&(e.debugInfoEnabled(!1),angular.reloadWithDebugInfo=angular.noop),delete window.jQuery,delete window.$}]).run(["$rootScope","securityService",function(e,u){e.security=u,e.$on("$routeChangeStart",function(e,n,t){var r=n.$$route;r&&r.extras.safe||r&&u.hasPermission(r.originalPath)||e.preventDefault()})}]).factory("authenticationService",["$resource","$rootScope","httpService","securityService",function(u,r,a,i){var o;return o={authenticate:function(e,n,t){var r={username:e,password:n};angular.equals(l,r)||u("authentication").create(r,function(e){c(e,r)},function(e){o.deauthenticate(),angular.isFunction(t)&&t(e)})},deauthenticate:function(){null!=l&&u("authentication").delete(function(){l=null,f={},a.setXSRFToken(null),r.$broadcast(i.UNSECURED)})},confirm:function(n,e){var t,r=a.getXSRFToken();r?(t={confirm:r},u("authentication").verify(t,function(e){c(e,t),angular.isFunction(n)&&n()},function(){o.deauthenticate(),angular.isFunction(e)&&e()})):angular.isFunction(e)&&e()},keepalive:function(e,n){u("authentication").read(function(){angular.isFunction(e)&&e()},function(e){o.deauthenticate(),angular.isFunction(n)&&callback()})}};function c(e,n){l=n,f={};var t=[];angular.forEach(e.permissions||[],function(e){e.rights.length&&(f[e.module]=e.rights)}),angular.forEach(e.permissions||[],function(e){i.hasPermission(e.module)&&t.push(e.module)}),a.setXSRFToken(e[s.xsrfHeaderName]),r.$broadcast(i.ENFORCED,t,e.user||{})}}]).provider("securityService",[function(){var r=angular.isUndefined,u={CREATE:"C",READ:"R",MODIFY:"U",DELETE:"D",CONFIRM:"F",VERIFY:"V",REJECT:"J"};this.acl=function(e){if(r(e))return u;u=e},this.$get=["$route",function(n){var t;return t={ACL:u,ENFORCED:"security.enforced",UNSECURED:"security.unsecured",hasPermission:function(n,e){if(a.filter(function(e){return e.extras.path===n}).length<1)return!1;if(r(n))return!1;var t=f[n];return!r(t)&&(r(e)?0<t.length:-1!=t.indexOf(e))},canCreate:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.hasPermission(e,t.ACL.CREATE)},canRead:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.hasPermission(e,t.ACL.READ)},canModify:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.hasPermission(e,t.ACL.MODIFY)},canDelete:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.hasPermission(e,t.ACL.DELETE)},canConfirm:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.hasPermission(e,t.ACL.CONFIRM)},canVerfy:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.hasPermission(e,t.ACL.VERIFY)},canReject:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.hasPermission(e,t.ACL.REJECT)},canChange:function(e){return e=e||n.current&&n.current.$$route.extras.path,t.canCreate(e)||t.canModify(e)||t.canDelete(e)||t.canConfirm(e)||t.canVerfy(e)||t.canReject(e)}}}]}])});