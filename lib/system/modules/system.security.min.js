define(["require","exports","application"],function(e,t,r){var n=t.module=angular.module("system.security",["ng","ngResource","system.http"]),s={xsrfCookieName:"XSRF-TOKEN"},f={},d=null,u=r.uefi,a=r.routes;n.config(["$compileProvider","$httpProvider",function(e,t){u.progress("Application","setup system.security"),s=angular.merge(s,t.defaults),u.prodMode&&(e.debugInfoEnabled(!1),angular.reloadWithDebugInfo=angular.noop),delete window.jQuery,delete window.$}]).run(["$rootScope","securityService",function(e,u){e.security=u,e.$on("$routeChangeStart",function(e,t,r){var n=t.$$route;n&&n.extras.safe||n&&u.canRead(n.originalPath)||e.preventDefault()})}]).factory("authenticationService",["$resource","$rootScope","httpService","securityService",function(n,u,a,i){var o;return o={authenticate:function(e,t){var r={user:e,password:t};angular.equals(d,r)||n("authenticate").create(r,function(e){c(e,r)},o.deauthenticate)},deauthenticate:function(){null!=d&&n("authenticate").delete(function(){d=null,f={},a.setXSRFToken(null),u.$broadcast(i.UNSECURED)})},confirm:function(e){var t={confirm:e};n("authenticate").update(t,function(e){c(e,t)},o.deauthenticate)}};function c(e,t){d=t,f=angular.extend({},e.permissions||{}),a.setXSRFToken(e[s.xsrfCookieName]);var r=[];for(var n in e.menus)i.canRead(e.menus[n],i.ACL.READ)&&r.push(e.menus[n]);u.$broadcast(i.ENFORCED,r)}}]).provider("securityService",[function(){var n=angular.isUndefined,u={CREATE:"C",READ:"R",MODIFY:"U",DELETE:"D"};this.acl=function(e){if(n(e))return u;u=e},this.$get=["$route",function(t){var r;return r={ACL:u,ENFORCED:"security.enforced",UNSECURED:"security.unsecured",hasPermission:function(t,e){if(a.filter(function(e){return e.extras.path===t}).length<1)return!1;if(n(t))return!1;var r=f[t];return!n(r)&&(n(e)?0<r.length:-1!=r.indexOf(e.toUpperCase()))},canCreate:function(e){return e=e||t.current&&t.current.$$route.extras.path,r.hasPermission(e,r.ACL.CREATE)},canRead:function(e){return e=e||t.current&&t.current.$$route.extras.path,r.hasPermission(e,r.ACL.READ)},canModify:function(e){return e=e||t.current&&t.current.$$route.extras.path,r.hasPermission(e,r.ACL.MODIFY)},canDelete:function(e){return e=e||t.current&&t.current.$$route.extras.path,r.hasPermission(e,r.ACL.DELETE)}}}]}])});