define(["require","exports","application"],function(e,a,n){function t(a){var l=this.locale;r.dynamics=r.dynamics||{$$buf:{},put:function(e){e&&(e=e.substr(0,e.lastIndexOf("/")),this.$$buf[e]=!0)},has:function(e){return e=e.substr(0,e.lastIndexOf("/")),!!this.$$buf[e]}};var o=t.languages=t.languages||{},c=o[l]=o[l]||{},i=n.routes.concat(n.layout).filter(function(e){var a=e.language[l];return a&&!c[a]&&(!e.extras.dynamic||r.dynamics.has(a))}).map(function(e){return e.language[l]}),s="lib/angular.js/i18n/angular-locale_LOCALE.js";i.unshift(s.replace(/LOCALE/,l)),b&&b.$broadcast("$localeChangeStart",l),e(i,function(){for(var e=0;e<i.length;e++){var n=i[e];if(e)c[n]=!0,i[e]=[n,arguments[e]];else{var t=c[n]=c[n]||g(["ngLocale"]).get("$locale");i[e]=[s,arguments[e]],m.$locale&&m.$locale.id!==t.id&&$(m.$locale,t)}}r.bind({locale:l})(i),a&&a(u),b&&b.$broadcast("$localeChangeSuccess",l)})}function r(){var e=y[this.locale]=y[this.locale]||{};f(v.apply(arguments),function(a){f(a,function(a){r.dynamics.put(a[0]),f(a[1],function(a,n){e[n.toLowerCase()]=a})})})}function l(e){if(e=(e||Modernizr.localstorage&&localStorage["system.locale"]||navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage||m.locale||"zh-cn").toLowerCase(),-1==m.locales.indexOf(e)&&(e="zh-cn"),-1!==m.locales.indexOf(e)&&Modernizr.localstorage)try{localStorage["system.locale"]=e}catch(e){}return e}function o(e){if(!e)return"";e=e.trim().toLowerCase();var a=(y[m.locale]||{})[e];if(!a)return"TODO: Translate `"+e+"` in `"+m.locale+"`";var n=v.call(arguments,1);return n.length?a.replace(/\{(\d+)\}/g,function(e,a){var t=n[0|a];return void 0!==t?t:e}):a}function c(e,a){var n=0;switch(a){case"gbk":Array.from(e).forEach(function(e){var a=e.codePointAt(0);n+=a<=127?1:2});break;case"utf8":Array.from(e).forEach(function(e){var a=e.codePointAt(0);if(a<=127)n+=1;else if(a<=2047)n+=2;else if(a<=65535)n+=3;else{if(!(a<=1114111))return-1;n+=4}})}return n}function i(e){return parseInt(e,10)}var u=angular.module("gui.language",["ng"]),s=n.uefi,f=angular.forEach,g=angular.injector,d=angular.extend,$=angular.merge,v=Array.prototype.slice,y={},b=null,m={$locale:null,currency:n.currency||"Â¥",locales:n.locales||["zh-cn"],locale:n.locale},p=Number.isNaN||function(e){return e!==e};m.locale=l(),d(a,{name:u.name,module:t.bind({locale:m.locale})}),["locale","locales","currency"].forEach(function(e){delete n[e]}),u.config(["$provide",function(e){m.$locale||(s.progress("Application","setup gui.language"),e.decorator("currencyFilter",["$delegate",function(e){return d(function(){var a=v.apply(arguments);return a[1]&&"$system$"!==a[1]||(a[1]=m.currency),e.apply(e,a)},{$stateful:!0})}]),["date","number"].forEach(function(a){e.decorator(a+"Filter",["$delegate",function(e){return d(e,{$stateful:!0})}])}))}]).run(["$locale","$rootScope",function(e,a){m.$locale||(m.$locale=e,angular.extend(b=a,{language:{loadLanguage:r.bind(m),translate:o.bind({}),getLocale:function(){return m.locale},getLocales:function(){return[].concat(m.locales)},setLocale:function(e){e=l(e.toLowerCase()),t.bind({locale:e})(function(){m.locale=e})}}}))}]).directive("maxbytes",function(){return{restrict:"A",require:"?ngModel",link:function(e,a,n,t){if(t){var r=-1,l="utf8";n.$observe("maxbytes",function(e){var a=i(e)||0;r=p(a)?-1:a,t.$validate()}),n.$observe("charset",function(e){if(!t.$isEmpty(e)){switch(e=e.toLowerCase()){case"gbk":case"utf8":l=e;break;default:return}t.$validate()}}),t.$validators.maxbytes=function(e,a){if(r<0||t.$isEmpty(a))return!0;var n=c(a,l);return-1!==n&&n<=r}}}}}).directive("minbytes",function(){return{restrict:"A",require:"?ngModel",link:function(e,a,n,t){if(t){var r=0,l="utf8";n.$observe("minbytes",function(e){var a=i(e)||0;r=p(a)?-1:a,t.$validate()}),n.$observe("charset",function(e){if(!t.$isEmpty(e)){switch(e=e.toLowerCase()){case"gbk":case"utf8":l=e;break;default:return}t.$validate()}}),t.$validators.minbytes=function(e,a){if(t.$isEmpty(a))return!0;var n=c(a,l);return-1!==n&&n>=r}}}}}).filter("translate",function(){return d(o,{$stateful:!0})})});