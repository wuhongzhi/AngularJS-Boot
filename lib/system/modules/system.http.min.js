define(["require","exports","application"],function(e,t,r){var n=t.module=angular.module("system.http",["ng","ngResource"]),o={xsrfHeaderName:"X-XSRF-TOKEN"},a=Array.prototype.slice,i=r.uefi,s=i.native.desktop||i.native.mobile?function(){if(i.native.desktop){var e=i.native.desktop.etc;if(e&&e.baseUrl)return e.baseUrl}if(/https?:/.test(location.protocol))return location.pathname;var t=document.querySelector('meta[http-equiv="Content-Rest-Service"]');if(t)return t.content;throw new Error("No RPC meta in declaring")}():r.$$baseUrl(),c=null;s.endsWith("/")||(s+="/"),s+=r.services||"api/",delete r.services;var u={read:{method:"GET",isArray:!0},create:{method:"POST"},delete:{method:"DELETE"},modify:{method:"PUT"}};n.config(["$provide","$httpProvider",function(e,t){i.progress("Application","setup system.http"),e.decorator("$resource",["$delegate",function(r){return function(){var e=a.apply(arguments);if(e.length&&!/^device:\/\//.test(e[0]))for(var t in e[0]=s+e[0],e[2]=e[2]||{},u)e[2][t]=u[t];return r.apply(r,e)}}]),o=t.defaults,t.interceptors.push(["$q","httpService","$injector",function(t,e,r){var n=null;return{request:function(e){return e.headers["X-Requested-By"]="XRich-Client",c&&e.url.startsWith(s)&&(e.headers[o.xsrfHeaderName]=c),e},responseError:function(e){return 401===e.status&&(n=n||r.get("authenticationService")).deauthenticate(),t.reject(e)}}}])}]).service("httpService",function(){return{setJaxRSActs:function(e){angular.forEach(e,function(e){u[e.function]={method:e.method,isArray:!!e.array}})},setXSRFToken:function(e){c=e,Modernizr.localstorage&&(e?localStorage.setItem(o.xsrfHeaderName,e):localStorage.removeItem(o.xsrfHeaderName))},getXSRFToken:function(){return c||(Modernizr.localstorage?localStorage.getItem(o.xsrfHeaderName):void 0)}}})});