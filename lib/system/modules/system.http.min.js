define(["require","exports","application"],function(e,t,r){var n=t.module=angular.module("system.http",["ng","ngResource"]),i={xsrfHeaderName:"X-XSRF-TOKEN"},o=Array.prototype.slice,s=r.uefi,u=s.native.desktop||s.native.mobile?function(){if(/https?:/.test(location.protocol))return location.pathname;var e=document.querySelector('meta[http-equiv="Content-Rest-Service"]');if(e)return e.content;throw new Error("No RPC meta in declaring")}():r.$$baseUrl(),c=null;u.endsWith("/")||(u+="/"),u+=r.services||"rest/",delete r.services,n.config(["$provide","$httpProvider",function(e,t){s.progress("Application","setup system.http"),e.decorator("$resource",["$delegate",function(e){return function(){var t=o.apply(arguments);return t.length&&!/^device:\/\//.test(t[0])&&(t[0]=u+t[0]),e.apply(e,t)}}]),i=t.defaults,t.interceptors.push(["$q","httpService","securityService",function(e,t,r){return{request:function(e){return c&&e.url.startsWith(u)&&(e.headers[i.xsrfHeaderName]=c),e},response:function(e){return 401===e.status&&r.deauthenticate(),e}}}])}]).service("httpService",function(){return{setXSRFToken:function(e){c=e}}})});