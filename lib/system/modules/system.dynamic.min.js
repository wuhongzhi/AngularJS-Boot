define(["require","exports","application"],function(t,e,n){var a=e.module=angular.module("system.dynamic",["system.http","gui.language"]),o=n.dependModules,l=Array.prototype.slice,d=n.uefi;a.config(function(){d.progress("Application","setup system.dynamics")}).run(["$rootScope","$location","$route","$injector",function(p,s,a,c){p.$on("$locationChangeStart",function(e){var i=a.routes[s.path()];if(i&&!i.ready&&!i.inProgress&&!e.defaultPrevented){i.inProgress=!0,e.preventDefault();l.apply(arguments);var u=i.language[p.language.getLocale()];d.progress("Application","load dynamic module > "+i.extras.path);var n=o(i,[]).map(function(e){return e.script});t(n.concat([i.script,u]),function(){var n=l.apply(arguments),a=u&&n.pop(),t=[];if(n=n.filter(function(e){if(!angular.isFunction(e.module))return angular.isUndefined(c.modules[e.name]);t.push(e)}).map(function(e){return e.module}),t.length){var o=t.length;t.forEach(function(e){e.module(function(){n=n.concat(l.apply(arguments)),--o<1&&r(n)})})}else n.length&&r(n);function r(e){d.progress("Application","setup dynamic module > "+i.extras.path),e=e.map(function(e){return d.progress("Application","setup module > "+e.name),e.name}),c.loadNewModules(e),u&&p.language.loadLanguage([[u,a]]),i.ready=!0,i.inProgress=!1,i.extras.dynamic=!1,s.path(i.extras.path),p.$broadcast("$locationChangeSuccess")}})}})}])});