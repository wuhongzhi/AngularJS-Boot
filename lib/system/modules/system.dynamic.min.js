define(["require","exports","application"],function(t,e,n){var a=e.module=angular.module("system.dynamic",["system.http","gui.language"]),o=n.dependModules,d=Array.prototype.slice,g=n.uefi;a.config(function(){g.progress("Application","setup system.dynamics")}).run(["$rootScope","$location","$route","$injector",function(l,p,a,s){var c=l.$broadcast;l.$on("$locationChangeStart",function(e){var i=a.routes[p.path()];if(i&&!i.ready&&!i.inProgress&&!e.defaultPrevented){i.inProgress=!0,e.preventDefault();d.apply(arguments);var u=i.language[l.language.getLocale()];g.progress("Application","load dynamic module > "+i.extras.path);var n=o(i,[]).map(function(e){return e.script});t(n.concat([i.script,u]),function(){var n=d.apply(arguments),a=u&&n.pop(),t=[];if(n=n.filter(function(e){if(!angular.isFunction(e.module))return angular.isUndefined(s.modules[e.name]);t.push(e)}).map(function(e){return e.module}),t.length){var o=t.length;t.forEach(function(e){e.module(function(){n=n.concat(d.apply(arguments)),--o<1&&r(n)})})}else n.length&&r(n);function r(e){g.progress("Application","setup dynamic module > "+i.extras.path),e=e.map(function(e){return g.progress("Application","setup module > "+e.name),e.name}),s.loadNewModules(e),u&&l.language.loadLanguage([[u,a]]),i.ready=!0,i.inProgress=!1,i.extras.dynamic=!1,p.path(i.extras.path),c.call(l,"$locationChangeSuccess")}})}})}])});