define(["require","exports","application"],function(t,e,n){var a=e.module=angular.module("system.dynamic",["system.http","gui.language"]),o=n.dependModules,d=Array.prototype.slice,g=n.uefi;a.config(function(){g.progress("Application","setup system.dynamics")}).run(["$rootScope","$location","$route","$injector","languageService",function(p,c,a,s,l){p.$on("$locationChangeStart",function(e){var i,n,u=a.routes[c.path()];!u||u.ready||u.inProgress||e.defaultPrevented||(u.inProgress=!0,e.preventDefault(),d.apply(arguments),i=u.language[l.getLocale()],g.progress("Application","load dynamic module > "+u.extras.path),n=o(u,[]).map(function(e){return e.script}),t(n.concat([u.script,i]),function(){var n,a=d.apply(arguments),t=i&&a.pop(),o=[];function r(e){g.progress("Application","setup dynamic module > "+u.extras.path),e=e.map(function(e){return g.progress("Application","setup module > "+e.name),e.name}),s.loadNewModules(e),i&&l.loadLanguage([[i,t]]),u.ready=!0,u.inProgress=!1,u.extras.dynamic=!1,c.path(u.extras.path),p.$broadcast("$locationChangeSuccess")}a=a.filter(function(e){if(!angular.isFunction(e.module))return angular.isUndefined(s.modules[e.name]);o.push(e)}).map(function(e){return e.module}),o.length?(n=o.length,o.forEach(function(e){e.module(function(){a=a.concat(d.apply(arguments)),--n<1&&r(a)})})):a.length&&r(a)}))})}])});